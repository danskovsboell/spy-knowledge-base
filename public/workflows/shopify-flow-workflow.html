<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopify Integration Workflow - SPY System</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="/workflows/i18n.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --spy-black: #1a1a1a;
            --spy-dark: #0f0f0f;
            --spy-gold: #c9a227;
            --spy-gold-light: #d4b84a;
            --spy-white: #ffffff;
            --spy-gray: #888888;
            --spy-gray-light: #b3b3b3;
            --spy-gray-dark: #333333;
            --shopify-green: #96bf48;
            --shopify-green-light: #b8d98a;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Raleway', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--spy-black);
            min-height: 100vh;
            padding: 40px;
            color: var(--spy-white);
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { 
            text-align: center; 
            margin-bottom: 10px; 
            font-size: 2.5em;
            font-family: 'Raleway', sans-serif;
            font-weight: 600;
        }
        .subtitle { text-align: center; color: var(--spy-gray); margin-bottom: 40px; }
        
        .workflow-section {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--spy-gray-dark);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 1.4em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--spy-gold);
            font-family: 'Raleway', sans-serif;
            font-weight: 600;
        }
        
        .flow-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .flow-box {
            background: var(--spy-dark);
            border: 1px solid var(--spy-gray-dark);
            border-radius: 12px;
            padding: 20px;
            min-width: 160px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .flow-box:hover {
            border-color: var(--spy-gold);
            background: rgba(201, 162, 39, 0.05);
        }
        
        .flow-box.shopify { border-top: 3px solid var(--shopify-green); }
        .flow-box.spy { border-top: 3px solid var(--spy-gold); }
        .flow-box.queue { border-top: 3px solid #e67e22; }
        .flow-box.result { border-top: 3px solid #2ecc71; }
        
        .flow-box-icon { font-size: 2em; margin-bottom: 10px; }
        .flow-box-title { font-weight: 600; margin-bottom: 5px; color: var(--spy-white); }
        .flow-box-desc { font-size: 0.85em; color: var(--spy-gray); }
        
        .arrow { font-size: 2em; color: var(--spy-gold); }
        
        .doc-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .doc-card {
            background: var(--spy-dark);
            border: 1px solid var(--spy-gray-dark);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        .doc-card:hover { border-color: var(--spy-gold); }
        .doc-card.webhook { border-left: 3px solid var(--shopify-green); }
        .doc-card.task { border-left: 3px solid var(--spy-gold); }
        .doc-card.config { border-left: 3px solid #e67e22; }
        .doc-card.error { border-left: 3px solid #e74c3c; }
        
        .doc-card-title { 
            font-weight: 600; 
            margin-bottom: 8px; 
            color: var(--spy-gold);
        }
        .doc-card-desc { font-size: 0.85em; color: var(--spy-gray-light); }
        
        .code-path {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.7em;
            color: var(--spy-gold);
            background: rgba(201, 162, 39, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 8px;
            word-break: break-all;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        .legend-color.shopify { background: var(--shopify-green); }
        .legend-color.spy { background: var(--spy-gold); }
        .legend-color.queue { background: #e67e22; }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .info-card {
            background: var(--spy-dark);
            border: 1px solid var(--spy-gray-dark);
            border-radius: 10px;
            padding: 20px;
        }
        .info-card-title {
            font-weight: 600;
            color: var(--spy-gold);
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .info-card-list {
            list-style: none;
            padding: 0;
        }
        .info-card-list li {
            padding: 5px 0;
            color: var(--spy-gray-light);
            font-size: 0.9em;
        }
        .info-card-list li::before {
            content: "‚Üí ";
            color: var(--spy-gold);
        }
        
        .code-structure {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85em;
            line-height: 1.8;
            background: var(--spy-dark);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--spy-gray-dark);
        }
        .code-structure .folder { color: var(--spy-gold); }
        .code-structure .comment { color: var(--spy-gray); }
        
        .priority-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .priority-table th, .priority-table td {
            padding: 10px 15px;
            text-align: left;
            border-bottom: 1px solid var(--spy-gray-dark);
            font-size: 0.9em;
        }
        .priority-table th {
            color: var(--spy-gold);
            font-weight: 600;
        }
        .priority-table td { color: var(--spy-gray-light); }
        
        .note-box {
            margin-top: 12px;
            padding: 10px 16px;
            background: rgba(201,162,39,0.08);
            border-radius: 8px;
            font-size: 0.85em;
            color: #b3b3b3;
        }
        .note-box strong { color: #c9a227; }
        
        .master-box {
            margin-top: 12px;
            padding: 14px 18px;
            background: rgba(201,162,39,0.12);
            border: 1px solid var(--spy-gold);
            border-radius: 8px;
            font-size: 0.95em;
            color: var(--spy-white);
            text-align: center;
        }
        .master-box strong { color: #c9a227; }
        
        .footer-text {
            text-align: center;
            color: var(--spy-gray);
            margin-top: 40px;
            font-size: 0.9em;
        }
        .footer-text span { color: var(--spy-gold); }

        /* Tech Details Accordion */
        .tech-details {
            margin-top: 16px;
            border: 1px solid var(--spy-gray-dark);
            border-radius: 8px;
            overflow: hidden;
        }
        .tech-details-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 10px 16px;
            background: rgba(255,255,255,0.03);
            border: none;
            color: var(--spy-gray);
            cursor: pointer;
            font-family: 'Raleway', sans-serif;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: left;
        }
        .tech-details-toggle:hover {
            background: rgba(201,162,39,0.08);
            color: var(--spy-gold-light);
        }
        .tech-details-toggle.open {
            color: var(--spy-gold);
            border-bottom: 1px solid var(--spy-gray-dark);
        }
        .tech-details-toggle .chevron {
            transition: transform 0.3s ease;
            font-size: 0.8em;
        }
        .tech-details-toggle.open .chevron {
            transform: rotate(90deg);
        }
        .tech-details-content {
            padding: 16px;
            background: rgba(0,0,0,0.2);
        }
        .tech-details-content.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const Arrow = () => <span className="arrow">‚Üí</span>;
        
        const FlowBox = ({ icon, title, desc, type }) => (
            <div className={`flow-box ${type}`}>
                <div className="flow-box-icon">{icon}</div>
                <div className="flow-box-title">{title}</div>
                <div className="flow-box-desc">{desc}</div>
            </div>
        );
        
        const DocCard = ({ title, desc, type, path }) => (
            <div className={`doc-card ${type}`}>
                <div className="doc-card-title">{title}</div>
                <div className="doc-card-desc">{desc}</div>
                {path && <div className="code-path">{path}</div>}
            </div>
        );
        
        const TechDetails = ({ label, children }) => {
            const [open, setOpen] = React.useState(false);
            return (
                <div className="tech-details">
                    <button className={`tech-details-toggle ${open ? 'open' : ''}`} onClick={() => setOpen(!open)}>
                        <span className="chevron">‚ñ∂</span> {label || 'Vis tekniske detaljer'}
                    </button>
                    <div className={`tech-details-content ${open ? '' : 'hidden'}`}>
                        {children}
                    </div>
                </div>
            );
        };
        
        const ShopifyWorkflow = ({ t = (k) => k, locale = 'da' }) => {
            return (
                <div className="container">
                    <h1>{t("Shopify integration")}</h1>
                    <p className="subtitle">{t("Hvordan SPY og Shopify arbejder sammen ‚Äì synkronisering af produkter, ordrer og lager")}</p>

                    {/* Master Data Principle */}
                    <div className="master-box">
                        <strong>üîë {t("Grundprincip:")}</strong> {t("SPY er master for produktdata (styles, farver, priser, lager). Shopify er master for ordredata (ordrer, returneringer, refunds).")}
                    </div>
                    
                    <div style={{height: '24px'}}></div>

                    <div className="legend">
                        <div className="legend-item">
                            <div className="legend-color shopify"></div>
                            <span>{t("Shopify")}</span>
                        </div>
                        <div className="legend-item">
                            <div className="legend-color spy"></div>
                            <span>{t("SPY System")}</span>
                        </div>
                        <div className="legend-item">
                            <div className="legend-color queue"></div>
                            <span>{t("K√∏ (asynkron)")}</span>
                        </div>
                    </div>
                    
                    {/* Section 1: SPY ‚Üí Shopify (Product Data) */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üì§ SPY ‚Üí Shopify (Produktdata)")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '20px', lineHeight: '1.6'}}>
                            {t("N√•r du opdaterer produktdata i SPY, synkroniseres √¶ndringerne automatisk til Shopify. SPY er master ‚Äì det er altid SPY-data der \"vinder\".")}
                        </p>
                        <div className="flow-container">
                            <FlowBox icon="‚úèÔ∏è" title={t("√Ündring i SPY")} desc={t("Style, farve, pris, lager...")} type="spy" />
                            <Arrow />
                            <FlowBox icon="üìã" title={t("Opgave i k√∏")} desc={t("S√¶ttes automatisk i k√∏")} type="queue" />
                            <Arrow />
                            <FlowBox icon="üîÑ" title={t("Sync til Shopify")} desc={t("Opdaterer via API")} type="spy" />
                            <Arrow />
                            <FlowBox icon="üõçÔ∏è" title={t("Shopify opdateret")} desc={t("√Ündring live i webshoppen")} type="shopify" />
                        </div>
                        
                        <div className="info-grid" style={{marginTop: '20px'}}>
                            <div className="info-card">
                                <div className="info-card-title">{t("üëó Produktdata")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Style-navn, beskrivelse, type, kvalitet")}</li>
                                    <li>{t("Farver og farvenavne")}</li>
                                    <li>{t("St√∏rrelser og varianter")}</li>
                                    <li>{t("Brand og kategori")}</li>
                                    <li>{t("Vaskeanvisninger og dimensioner")}</li>
                                    <li>{t("Custom fields / metafields")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üì∏ Billeder & Media")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Produktbilleder synkroniseres automatisk")}</li>
                                    <li>{t("Farve-specifikke billeder kobles korrekt")}</li>
                                    <li>{t("R√¶kkef√∏lge styres fra SPY")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üí∞ Priser & Lager")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Priser pr. market/valuta")}</li>
                                    <li>{t("Lagerbeholdning pr. lokation")}</li>
                                    <li>{t("Overs√¶ttelser til flere sprog")}</li>
                                    <li>{t("Kampagnepriser og s√¶sonpriser")}</li>
                                </ul>
                            </div>
                        </div>
                        <div className="note-box">
                            <strong>{t("üí° Hvad trigger sync?")}</strong> {t("N√•r du gemmer en style, √¶ndrer en farve, opdaterer priser, retter lagerbeholdning eller √¶ndrer overs√¶ttelser i SPY, oprettes automatisk en opgave i k√∏en der sender √¶ndringen til Shopify.")}
                        </div>
                        
                        <TechDetails label={t("Vis tekniske detaljer ‚Äì Eksport-tasks og triggers")}>
                            <div className="info-grid">
                                <div className="info-card">
                                    <div className="info-card-title">{t("üì§ Eksport Task-typer")}</div>
                                    <ul className="info-card-list">
                                        <li>ProductDataExport(Manager) ‚Äî {t("produktdata")}</li>
                                        <li>ProductMediaExport(Manager) ‚Äî {t("billeder/media")}</li>
                                        <li>ProductPriceExport ‚Äî {t("priser")}</li>
                                        <li>ProductStockExport ‚Äî {t("lagerbeholdning")}</li>
                                        <li>ProductTranslationExport ‚Äî {t("overs√¶ttelser")}</li>
                                        <li>ProductDataAndMediaExport(Manager) ‚Äî {t("kombineret")}</li>
                                        <li>ProductDelete / ProductDeleteVariant</li>
                                        <li>ProductBulkUpdatePrices</li>
                                        <li>SeasonCampaignPriceUpdate</li>
                                        <li>PausePriceUpdatesPriceUpdate</li>
                                    </ul>
                                </div>
                                <div className="info-card">
                                    <div className="info-card-title">{t("‚ö° Triggers i koden")}</div>
                                    <ul className="info-card-list">
                                        <li><code>Style::sendToShopifyShops()</code> ‚Äî {t("ved style-√¶ndring")}</li>
                                        <li><code>ShopifyEventHandler</code> ‚Äî {t("ved √¶ndring af ColorMaster, Type, Quality")}</li>
                                        <li>{t("Felter der trigger: farvenavn, st√∏rrelse, brand, stylenr, kvalitet, kategori, dimensioner, vaskeanvisning")}</li>
                                        <li>{t("Lokaliserings-√¶ndringer trigger ProductTranslationExport")}</li>
                                        <li><code>ConsignmentOrder</code> ‚Äî {t("trigger ved lager√¶ndring")}</li>
                                    </ul>
                                </div>
                            </div>
                            <div className="note-box">
                                <strong>{t("üìÅ Kode:")}</strong> <code>class/EDI/Shopify/ShopifyEventHandler.php</code>, <code>class/Style/Style.php</code>, <code>class/EDI/Shopify/Entity/ShopifyShop.php</code>
                            </div>
                        </TechDetails>
                    </div>
                    
                    {/* Section 2: Shopify ‚Üí SPY (Orders) */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üì• Shopify ‚Üí SPY (Ordrer)")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '20px', lineHeight: '1.6'}}>
                            {t("N√•r en kunde afgiver en ordre i Shopify, sendes den automatisk til SPY via webhooks. Shopify er master for ordredata ‚Äì ordren oprettes i Shopify og importeres til SPY.")}
                        </p>
                        <div className="flow-container">
                            <FlowBox icon="üõçÔ∏è" title={t("Ordre i Shopify")} desc={t("Kunde afgiver ordre")} type="shopify" />
                            <Arrow />
                            <FlowBox icon="üì°" title={t("Webhook")} desc={t("Shopify giver besked")} type="shopify" />
                            <Arrow />
                            <FlowBox icon="üìã" title={t("K√∏")} desc={t("Opgave oprettes")} type="queue" />
                            <Arrow />
                            <FlowBox icon="üì¶" title={t("Import")} desc={t("Ordre oprettes i SPY")} type="spy" />
                            <Arrow />
                            <FlowBox icon="‚úÖ" title={t("Klar")} desc={t("Klar til behandling")} type="result" />
                        </div>
                        <div className="info-grid" style={{marginTop: '20px'}}>
                            <div className="info-card">
                                <div className="info-card-title">{t("üõí Ordreimport")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Ordren hentes komplet fra Shopify (linjer, fragt, moms, betalinger)")}</li>
                                    <li>{t("Kunde matches eller oprettes automatisk")}</li>
                                    <li>{t("Fragt kobles via Webshipper-integration")}</li>
                                    <li>{t("Fraud-check: ordrer under 5 min. venter p√• Shopify's vurdering")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üîÑ Automatisk sikkerhedsnet")}</div>
                                <ul className="info-card-list">
                                    <li>{t("SPY tjekker l√∏bende om der er ordrer der er g√•et tabt")}</li>
                                    <li>{t("Sammenligner Shopify-ordrer med hvad SPY har modtaget")}</li>
                                    <li>{t("Manglende ordrer hentes automatisk")}</li>
                                    <li>{t("Sikrer at ingen ordrer misses, selv ved nedbrud")}</li>
                                </ul>
                            </div>
                        </div>
                        <div className="note-box">
                            <strong>{t("üí° Ops√¶tning:")}</strong> {t("Ordreimport aktiveres per shop i Admin ‚Üí Settings ‚Üí Integration ‚Üí Shopify. Kr√¶ver at \"Import√©r ordrer\" er sl√•et til.")}
                        </div>
                        
                        <TechDetails label={t("Vis tekniske detaljer ‚Äì Webhook-validering og tasks")}>
                            <div className="info-grid">
                                <div className="info-card">
                                    <div className="info-card-title">{t("üîê HMAC Validering")}</div>
                                    <ul className="info-card-list">
                                        <li>{t("Dobbelt validering: Middleware + Model (belt-and-suspenders)")}</li>
                                        <li><code>ShopifyWebhookValidator</code> ‚Äî {t("middleware")}</li>
                                        <li><code>Model::verifyWebhook()</code> ‚Äî {t("model-lag")}</li>
                                        <li>{t("HMAC-SHA256 signatur fra")} <code>X-Shopify-Hmac-Sha256</code></li>
                                        <li>{t("Shop identificeres via")} <code>X-Shopify-Shop-Domain</code></li>
                                        <li>{t("S√¶tter system-bruger til 'Chuck Norris'")}</li>
                                    </ul>
                                </div>
                                <div className="info-card">
                                    <div className="info-card-title">{t("üìã Ordre-tasks")}</div>
                                    <ul className="info-card-list">
                                        <li><code>OrderMirrorTask</code> ‚Äî {t("henter fuld ordre via GraphQL")}</li>
                                        <li><code>OrderImportTask</code> ‚Äî {t("opretter SOrder i SPY")}</li>
                                        <li><code>OrderMirrorCheckTask</code> ‚Äî {t("fallback-tjek for mistede ordrer (tjekker 2 √•r tilbage)")}</li>
                                        <li><code>OrderExport</code> / <code>OrderCheck</code> ‚Äî {t("synkronisering")}</li>
                                        <li><code>OrderCheckTransactionStatus</code> ‚Äî {t("betalingsstatus")}</li>
                                        <li>{t("Endpoint:")} <code>POST /api/v1/webhook/shopify</code></li>
                                    </ul>
                                </div>
                                <div className="info-card">
                                    <div className="info-card-title">{t("‚öôÔ∏è Konfigurationsvariabler")}</div>
                                    <ul className="info-card-list">
                                        <li><code>bFullIntegrationEnabled</code> ‚Äî {t("master switch for ordreimport")}</li>
                                        <li><code>bImportOrders</code> ‚Äî {t("per shop: import√©r ordrer")}</li>
                                        <li><code>bReadOnly</code> ‚Äî {t("kun l√¶seadgang")}</li>
                                        <li><code>allowExchange()</code> + <code>ReadCustomers</code> {t("scope")}</li>
                                        <li>{t("Webhooks registreres automatisk via")} <code>synchronizeWebhooks()</code></li>
                                    </ul>
                                </div>
                            </div>
                        </TechDetails>
                    </div>

                    {/* Section 3: Fulfillment, Returns & Refunds */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üì¶ Fulfillment, Returneringer & Refunds")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '20px', lineHeight: '1.6'}}>
                            {t("Shopify sender automatisk besked til SPY n√•r der sker √¶ndringer i fulfillments, returneringer og refunds. Disse h√•ndteres ligesom ordrer ‚Äì Shopify er master.")}
                        </p>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("üì¶ Fulfillments")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Oprettelse og opdatering af forsendelser")}</li>
                                    <li>{t("Relaterede returneringer importeres automatisk")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üîÑ Returneringer")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Godkendelse, afvisning, lukning, gen√•bning")}</li>
                                    <li>{t("Status synkroniseres l√∏bende")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üí∏ Refunds")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Refunds importeres og linkes til original ordre")}</li>
                                    <li>{t("Kr√¶ver RefundsAndReturns access layer")}</li>
                                </ul>
                            </div>
                        </div>

                        <TechDetails label={t("Vis tekniske detaljer ‚Äì Webhooks og tasks")}>
                            <div className="doc-types">
                                <DocCard 
                                    title={t("Fulfillments (2 topics)")}
                                    desc={t("fulfillments/create + update ‚Üí OrderMirrorTask + ReturnImportTask")}
                                    type="webhook"
                                    path="FulfillmentsWebhookData"
                                />
                                <DocCard 
                                    title={t("Returns (7 topics)")}
                                    desc={t("approve, cancel, close, decline, reopen, request, update ‚Üí ReturnImportTask")}
                                    type="webhook"
                                    path="ReturnsWebhookData"
                                />
                                <DocCard 
                                    title={t("Refunds (1 topic)")}
                                    desc={t("refunds/create ‚Üí RefundImportTask")}
                                    type="webhook"
                                    path="RefundsCreateWebhookData"
                                />
                            </div>
                            <div className="note-box">
                                <strong>{t("Krav:")}</strong> <code>allowRefundAndReturnImport()</code> ‚Äî {t("kr√¶ver ordreimport + RefundsAndReturns access layer")}
                            </div>
                        </TechDetails>
                    </div>

                    {/* Section 4: Markets & Locations */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üåç Markets & Lokationer")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '15px', lineHeight: '1.6'}}>
                            {t("Shopify's markets (lande/regioner) og lokationer (lagersteder) synkroniseres automatisk til SPY. √Ündringer i Shopify fanges via webhooks.")}
                        </p>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("üåç Markets")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Oprettelse, √¶ndring og sletning synkroniseres")}</li>
                                    <li>{t("Bruges til markeds-specifikke priser")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üìç Lokationer")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Oprettelse, √¶ndring og sletning synkroniseres")}</li>
                                    <li>{t("Bruges til lagerfordeling")}</li>
                                </ul>
                            </div>
                        </div>

                        <TechDetails label={t("Vis tekniske detaljer ‚Äì Sync-tasks")}>
                            <ul className="info-card-list" style={{padding: '0 10px'}}>
                                <li><code>SynchronizeMarketsTask</code> / <code>SynchronizeLocationsTask</code></li>
                                <li><code>SynchronizeMarketPrices</code> / <code>SynchronizeMarketPriceListPrices</code></li>
                                <li><code>SynchronizeLocales</code> / <code>SynchronizeProductIDs</code></li>
                                <li>{t("Kr√¶ver ReadMarkets / ReadLocations scope")}</li>
                            </ul>
                        </TechDetails>
                    </div>

                    {/* Section 5: Create2Stay */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üé® Create2Stay")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '15px', lineHeight: '1.6'}}>
                            {t("Create2Stay er en specialfunktion for kunder der bruger Shopify's Create2Stay-app til at lade slutkunder designe produkter. Kun relevant hvis det er aktiveret for shoppen.")}
                        </p>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("S√•dan virker det")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Slutkunde designer et produkt i Shopify via Create2Stay-appen")}</li>
                                    <li>{t("Produktet oprettes i Shopify og webhook sendes til SPY")}</li>
                                    <li>{t("SPY importerer produktet og kobler det til det rette brand")}</li>
                                    <li>{t("Fulfillments og returneringer h√•ndteres ogs√• via Create2Stay")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("Hvorn√•r er det relevant?")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Kun for shops med Create2Stay aktiveret")}</li>
                                    <li>{t("Indstillingen \"Create2Stay Brand\" skal v√¶re sat (‚â† 0)")}</li>
                                    <li>{t("Verificerer at produktet er oprettet af Create2Stay-appen")}</li>
                                </ul>
                            </div>
                        </div>

                        <TechDetails label={t("Vis tekniske detaljer ‚Äì Tasks og konfiguration")}>
                            <ul className="info-card-list" style={{padding: '0 10px'}}>
                                <li><code>Create2StaySynchronizeProductTask</code> ‚Äî {t("importerer produktet")}</li>
                                <li><code>Create2StayHandleFulfillmentTask</code> ‚Äî {t("h√•ndterer forsendelse")}</li>
                                <li><code>Create2StayHandleReturnTask</code> ‚Äî {t("h√•ndterer retur")}</li>
                                <li>{t("Trigger: products/create webhook hvor forfatter er Create2Stay-appen")}</li>
                                <li>{t("Konfiguration:")} <code>iCreate2StayBrandID</code> {t("p√• ShopifyShop entity (0 = deaktiveret)")}</li>
                            </ul>
                        </TechDetails>
                    </div>
                    
                    {/* Section 6: Queue */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("‚öôÔ∏è K√∏systemet")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '15px', lineHeight: '1.6'}}>
                            {t("Alle synkroniseringsopgaver h√•ndteres via en k√∏. Opgaver s√¶ttes i k√∏ og behandles asynkront i prioriteret r√¶kkef√∏lge. Du kan overv√•ge k√∏en i Admin ‚Üí Settings ‚Üí Integration ‚Üí Shopify ‚Üí Queue.")}
                        </p>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("üìä Status")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Ventende ‚Üí K√∏rer ‚Üí F√¶rdig")}</li>
                                    <li>{t("Ventende ‚Üí K√∏rer ‚Üí Fejl (pr√∏ver igen)")}</li>
                                    <li>{t("Ventende ‚Üí Sprunget over (ikke relevant)")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("‚è±Ô∏è Prioritering")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Ordrer har h√∏jeste prioritet")}</li>
                                    <li>{t("Produkt√¶ndringer k√∏rer med mellem prioritet")}</li>
                                    <li>{t("Baggrunds-sync k√∏rer med laveste prioritet")}</li>
                                </ul>
                            </div>
                        </div>

                        <TechDetails label={t("Vis tekniske detaljer ‚Äì Prioriteter, TTL og task-typer")}>
                            <table className="priority-table">
                                <thead>
                                    <tr>
                                        <th>{t("Prioritet")}</th>
                                        <th>{t("V√¶rdi")}</th>
                                        <th>{t("Typisk brug")}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>üî¥ Highest</td>
                                        <td>85</td>
                                        <td>{t("Order mirror + import (webhook)")}</td>
                                    </tr>
                                    <tr>
                                        <td>üü† High</td>
                                        <td>75</td>
                                        <td>‚Äî</td>
                                    </tr>
                                    <tr>
                                        <td>üü° Medium</td>
                                        <td>50</td>
                                        <td>{t("Bulk operationer, produkteksport")}</td>
                                    </tr>
                                    <tr>
                                        <td>üîµ Low</td>
                                        <td>25</td>
                                        <td>‚Äî</td>
                                    </tr>
                                    <tr>
                                        <td>‚ö™ Lowest</td>
                                        <td>15</td>
                                        <td>{t("Baggrunds-sync, OrderMirrorCheck")}</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div className="info-grid" style={{marginTop: '16px'}}>
                                <div className="info-card">
                                    <div className="info-card-title">{t("üóëÔ∏è Oprydning (TTL)")}</div>
                                    <ul className="info-card-list">
                                        <li>{t("Fuldf√∏rte: 30 dage")}</li>
                                        <li>{t("Fejlede: 90 dage (til debugging)")}</li>
                                        <li>{t("OrderMirror: 7 dage (h√∏j volumen)")}</li>
                                    </ul>
                                </div>
                                <div className="info-card">
                                    <div className="info-card-title">{t("üìã Alle 37 task-typer")}</div>
                                    <ul className="info-card-list">
                                        <li>{t("Ordre: OrderMirror, OrderImport, OrderExport, OrderCheck, m.fl. (10)")}</li>
                                        <li>{t("Produkt: ProductDataExport, ProductMediaExport, ProductPriceExport, m.fl. (12)")}</li>
                                        <li>{t("Refund/Return/Sync: RefundImport, ReturnImport, SynchronizeLocations, m.fl. (9)")}</li>
                                        <li>{t("Create2Stay & andet: 6 typer")}</li>
                                    </ul>
                                </div>
                            </div>
                            <div className="note-box">
                                <strong>{t("Worker:")}</strong> <code>ShopifyHandleQueueTask</code> ‚Äî {t("processerer")} <code>ShopifyShopQueueItem</code> {t("poster asynkront")}
                            </div>
                        </TechDetails>
                    </div>
                    
                    {/* Section 7: Configuration */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üîß Ops√¶tning")}</h2>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("üìç Hvor finder jeg det?")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Admin ‚Üí Settings ‚Üí Integration ‚Üí Shopify")}</li>
                                    <li>{t("Shop: opret, rediger, oversigt over forbundne shops")}</li>
                                    <li>{t("Order Mapping: feltkortl√¶gning for ordrer")}</li>
                                    <li>{t("Freight: fragtkonfiguration + unmapped")}</li>
                                    <li>{t("Queue: overv√•g og administrer k√∏")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üè™ Per shop-indstillinger")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Import√©r ordrer (til/fra)")}</li>
                                    <li>{t("Create2Stay brand (valgfrit)")}</li>
                                    <li>{t("L√¶setilstand (kun synkronisering, ingen eksport)")}</li>
                                    <li>{t("Adgangsrettigheder (scopes)")}</li>
                                </ul>
                            </div>
                        </div>

                        <TechDetails label={t("Vis tekniske detaljer ‚Äì Konfigurationsvariabler")}>
                            <div className="info-grid">
                                <div className="info-card">
                                    <div className="info-card-title">{t("üåê SystemConfig_Shopify (globalt)")}</div>
                                    <ul className="info-card-list">
                                        <li><code>bFullIntegrationEnabled</code> ‚Äî {t("master switch for ordreimport")}</li>
                                        <li><code>bReadOnly</code> ‚Äî {t("kun l√¶seadgang (ingen webhooks/exports)")}</li>
                                        <li><code>bDontReportFailedTransactions</code> ‚Äî {t("undertrykker transaktionsfejl")}</li>
                                        <li><code>bSkipSalesTaxLinesWithZeroValue</code> ‚Äî {t("ignorer nul-momslinjer")}</li>
                                        <li><code>bImportOrderNoteAttributesToSOrderComment</code></li>
                                    </ul>
                                </div>
                                <div className="info-card">
                                    <div className="info-card-title">{t("üè™ ShopifyShop entity (per shop)")}</div>
                                    <ul className="info-card-list">
                                        <li><code>bImportOrders</code> ‚Äî {t("import√©r ordrer")}</li>
                                        <li><code>iCreate2StayBrandID</code> ‚Äî {t("Create2Stay brand (0 = off)")}</li>
                                        <li>{t("Access Scopes: ReadLocations, ReadMarkets, ReadCustomers...")}</li>
                                        <li>{t("Access Layers: RefundsAndReturns")}</li>
                                        <li>{t("App Secret til HMAC verifikation")}</li>
                                    </ul>
                                </div>
                            </div>
                        </TechDetails>
                    </div>
                    
                    {/* Section 8: Troubleshooting */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üîç Fejlh√•ndtering")}</h2>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("üõí Ordre-problemer")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Ordre ikke importeret ‚Üí Tjek om \"Import√©r ordrer\" er sl√•et til")}</li>
                                    <li>{t("Fraud-vurdering mangler ‚Üí Venter maks 5 min, importerer derefter")}</li>
                                    <li>{t("Webshipper-fragtfejl ‚Üí Tjek freight mapping i Admin")}</li>
                                    <li>{t("Manglende ordrer ‚Üí SPY's sikkerhedsnet henter dem automatisk")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üì¶ Produkt-problemer")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Produkt ikke opdateret i Shopify ‚Üí Tjek k√∏en for fejl")}</li>
                                    <li>{t("Billeder mangler ‚Üí Tjek om media-eksport er i k√∏")}</li>
                                    <li>{t("Priser forkerte ‚Üí Tjek market-konfiguration")}</li>
                                </ul>
                            </div>
                        </div>
                        
                        <TechDetails label={t("Vis tekniske detaljer ‚Äì HTTP-fejlkoder og retry-logik")}>
                            <div className="doc-types">
                                <DocCard 
                                    title={t("401 Unauthorized")}
                                    desc={t("Ugyldigt shop-dom√¶ne, tomt app secret, eller HMAC mismatch.")}
                                    type="error"
                                />
                                <DocCard 
                                    title={t("422 Unprocessable")}
                                    desc={t("Ugyldig webhook-data (ShopifyWebhookDataException).")}
                                    type="error"
                                />
                                <DocCard 
                                    title={t("Webshipper: Ordre ikke fundet")}
                                    desc={t("Retry hvert 5. min i 60 min ‚Üí efter 120 min: karant√¶ne.")}
                                    type="error"
                                />
                                <DocCard 
                                    title={t("Webshipper: Fragtrate ikke fundet")}
                                    desc={t("Retry hvert 5. min i 60 min ‚Üí derefter fejl.")}
                                    type="error"
                                />
                                <DocCard 
                                    title={t("Database deadlock")}
                                    desc={t("TransactionDeadlockException ‚Äî retryable, automatisk.")}
                                    type="error"
                                />
                                <DocCard 
                                    title={t("Shopify API fejl")}
                                    desc={t("Forbidden, Locked, PaymentRequired, Unauthorized, NotFound.")}
                                    type="error"
                                />
                                <DocCard 
                                    title={t("Max 25 Webshipper retries")}
                                    desc={t("Efter 25 API-fejl ‚Üí permanent fejl.")}
                                    type="error"
                                />
                            </div>
                        </TechDetails>
                    </div>

                    {/* Section 9: Code Structure & CLI (tech only) */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üõ†Ô∏è Udviklerv√¶rkt√∏jer")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '15px', lineHeight: '1.6'}}>
                            {t("CLI-v√¶rkt√∏jer og kodestruktur til debugging og manuelle operationer.")}
                        </p>
                        
                        <TechDetails label={t("Vis tekniske detaljer ‚Äì Kodestruktur og CLI-v√¶rkt√∏jer")}>
                            <div className="code-structure">
                                <span className="folder">class/EDI/Shopify/</span><br/>
                                &nbsp;&nbsp;‚îú‚îÄ‚îÄ Entity/ShopifyShop.php <span className="comment">‚Üê {t("Shop-forbindelse + triggers")}</span><br/>
                                &nbsp;&nbsp;‚îú‚îÄ‚îÄ Entity/ShopifyShopQueueItem.php <span className="comment">‚Üê {t("Queue-poster")}</span><br/>
                                &nbsp;&nbsp;‚îú‚îÄ‚îÄ ShopifyEventHandler.php <span className="comment">‚Üê {t("Lytter p√• √¶ndringer i Style/Color/Quality/Type")}</span><br/>
                                &nbsp;&nbsp;‚îú‚îÄ‚îÄ API/ShopifyAPI.php <span className="comment">‚Üê {t("REST API klient")}</span><br/>
                                &nbsp;&nbsp;‚îú‚îÄ‚îÄ GraphQL/ShopifyGraphQLClient.php <span className="comment">‚Üê {t("GraphQL klient")}</span><br/>
                                &nbsp;&nbsp;‚îú‚îÄ‚îÄ Task/ <span className="comment">‚Üê {t("Alle 37 task-klasser")}</span><br/>
                                &nbsp;&nbsp;‚îÇ&nbsp;&nbsp;&nbsp;‚îú‚îÄ‚îÄ OrderMirrorTask.php<br/>
                                &nbsp;&nbsp;‚îÇ&nbsp;&nbsp;&nbsp;‚îú‚îÄ‚îÄ OrderImportTask.php<br/>
                                &nbsp;&nbsp;‚îÇ&nbsp;&nbsp;&nbsp;‚îú‚îÄ‚îÄ ProductDataExportManagerTask.php<br/>
                                &nbsp;&nbsp;‚îÇ&nbsp;&nbsp;&nbsp;‚îî‚îÄ‚îÄ ...<br/><br/>
                                <span className="folder">applications/API/V1/</span><br/>
                                &nbsp;&nbsp;‚îú‚îÄ‚îÄ Controller/Webhook/Shopify/Controller.php <span className="comment">‚Üê {t("Webhook endpoint")}</span><br/>
                                &nbsp;&nbsp;‚îú‚îÄ‚îÄ Model/Webhook/Shopify/Model.php <span className="comment">‚Üê {t("Routing + HMAC")}</span><br/>
                                &nbsp;&nbsp;‚îú‚îÄ‚îÄ Middleware/ShopifyWebhookValidator.php <span className="comment">‚Üê {t("HMAC middleware")}</span><br/>
                                &nbsp;&nbsp;‚îî‚îÄ‚îÄ Model/Webhook/Shopify/Data/ <span className="comment">‚Üê {t("Webhook data-klasser")}</span><br/><br/>
                                <span className="folder">class/SystemConfig/SystemConfig_Shopify.php</span> <span className="comment">‚Üê {t("Global konfiguration")}</span>
                            </div>
                            <div style={{height: '16px'}}></div>
                            <div className="doc-types">
                                <DocCard title="ImportOrder.php" desc={t("Import√©r en enkelt ordre efter Shopify order-ID")} type="task" path="tools/Shopify/" />
                                <DocCard title="OrderMirror.php" desc={t("Mirror en ordre manuelt")} type="task" path="tools/Shopify/" />
                                <DocCard title="QuarantineOrder.php" desc={t("S√¶t en ordre i karant√¶ne")} type="task" path="tools/Shopify/" />
                                <DocCard title="ProductStockCompare.php" desc={t("Sammenlign lager mellem SPY og Shopify")} type="task" path="tools/Shopify/" />
                                <DocCard title="SendAllStyles.php" desc={t("Eksport√©r alle styles til Shopify")} type="task" path="tools/Shopify/" />
                                <DocCard title="SynchronizeMarkets.php" desc={t("Synkroniser markets manuelt")} type="task" path="tools/Shopify/" />
                            </div>
                        </TechDetails>
                    </div>
                    
                    <p className="footer-text">
                        {t("Genereret af")} <span>Nova</span> | SPY ApS | {new Date().toLocaleDateString(locale === 'en' ? 'en-GB' : locale === 'nl' ? 'nl-NL' : 'da-DK')} | {t("Baseret p√• Spy codebase-analyse")}
                    </p>
                </div>
            );
        };
        
        // Initialize i18n and render
        (async function() {
            const { locale, t } = await window.i18n.initI18n('shopify-flow-workflow');
            ReactDOM.render(<ShopifyWorkflow t={t} locale={locale} />, document.getElementById('root'));
            window.i18n.autoApplyTranslations(200);
        })();
    </script>
</body>
</html>
