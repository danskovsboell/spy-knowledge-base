<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopify Integration Workflow - SPY System</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="/workflows/i18n.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --spy-black: #1a1a1a;
            --spy-dark: #0f0f0f;
            --spy-gold: #c9a227;
            --spy-gold-light: #d4b84a;
            --spy-white: #ffffff;
            --spy-gray: #888888;
            --spy-gray-light: #b3b3b3;
            --spy-gray-dark: #333333;
            --shopify-green: #96bf48;
            --shopify-green-light: #b8d98a;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Raleway', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--spy-black);
            min-height: 100vh;
            padding: 40px;
            color: var(--spy-white);
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { 
            text-align: center; 
            margin-bottom: 10px; 
            font-size: 2.5em;
            font-family: 'Raleway', sans-serif;
            font-weight: 600;
        }
        .subtitle { text-align: center; color: var(--spy-gray); margin-bottom: 40px; }
        
        .workflow-section {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--spy-gray-dark);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 1.4em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--spy-gold);
            font-family: 'Raleway', sans-serif;
            font-weight: 600;
        }
        
        .flow-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .flow-box {
            background: var(--spy-dark);
            border: 1px solid var(--spy-gray-dark);
            border-radius: 12px;
            padding: 20px;
            min-width: 160px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .flow-box:hover {
            border-color: var(--spy-gold);
            background: rgba(201, 162, 39, 0.05);
        }
        
        .flow-box.shopify { border-top: 3px solid var(--shopify-green); }
        .flow-box.spy { border-top: 3px solid var(--spy-gold); }
        .flow-box.queue { border-top: 3px solid #e67e22; }
        .flow-box.result { border-top: 3px solid #2ecc71; }
        
        .flow-box-icon { font-size: 2em; margin-bottom: 10px; }
        .flow-box-title { font-weight: 600; margin-bottom: 5px; color: var(--spy-white); }
        .flow-box-desc { font-size: 0.85em; color: var(--spy-gray); }
        
        .arrow { font-size: 2em; color: var(--spy-gold); }
        
        .doc-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .doc-card {
            background: var(--spy-dark);
            border: 1px solid var(--spy-gray-dark);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        .doc-card:hover { border-color: var(--spy-gold); }
        .doc-card.webhook { border-left: 3px solid var(--shopify-green); }
        .doc-card.task { border-left: 3px solid var(--spy-gold); }
        .doc-card.config { border-left: 3px solid #e67e22; }
        .doc-card.error { border-left: 3px solid #e74c3c; }
        
        .doc-card-title { 
            font-weight: 600; 
            margin-bottom: 8px; 
            color: var(--spy-gold);
        }
        .doc-card-desc { font-size: 0.85em; color: var(--spy-gray-light); }
        
        .code-path {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.7em;
            color: var(--spy-gold);
            background: rgba(201, 162, 39, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 8px;
            word-break: break-all;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        .legend-color.shopify { background: var(--shopify-green); }
        .legend-color.spy { background: var(--spy-gold); }
        .legend-color.queue { background: #e67e22; }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .info-card {
            background: var(--spy-dark);
            border: 1px solid var(--spy-gray-dark);
            border-radius: 10px;
            padding: 20px;
        }
        .info-card-title {
            font-weight: 600;
            color: var(--spy-gold);
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .info-card-list {
            list-style: none;
            padding: 0;
        }
        .info-card-list li {
            padding: 5px 0;
            color: var(--spy-gray-light);
            font-size: 0.9em;
        }
        .info-card-list li::before {
            content: "‚Üí ";
            color: var(--spy-gold);
        }
        
        .code-structure {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85em;
            line-height: 1.8;
            background: var(--spy-dark);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--spy-gray-dark);
        }
        .code-structure .folder { color: var(--spy-gold); }
        .code-structure .comment { color: var(--spy-gray); }
        
        .priority-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .priority-table th, .priority-table td {
            padding: 10px 15px;
            text-align: left;
            border-bottom: 1px solid var(--spy-gray-dark);
            font-size: 0.9em;
        }
        .priority-table th {
            color: var(--spy-gold);
            font-weight: 600;
        }
        .priority-table td { color: var(--spy-gray-light); }
        
        .note-box {
            margin-top: 12px;
            padding: 10px 16px;
            background: rgba(201,162,39,0.08);
            border-radius: 8px;
            font-size: 0.85em;
            color: #b3b3b3;
        }
        .note-box strong { color: #c9a227; }
        
        .footer-text {
            text-align: center;
            color: var(--spy-gray);
            margin-top: 40px;
            font-size: 0.9em;
        }
        .footer-text span { color: var(--spy-gold); }

        /* Support/Technical Toggle */
        .view-toggle {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: 30px;
        }
        .view-toggle button {
            padding: 10px 28px;
            border: 1px solid var(--spy-gray-dark);
            background: var(--spy-dark);
            color: var(--spy-gray);
            cursor: pointer;
            font-family: 'Raleway', sans-serif;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            outline: none;
        }
        .view-toggle button:first-child {
            border-radius: 20px 0 0 20px;
            border-right: none;
        }
        .view-toggle button:last-child {
            border-radius: 0 20px 20px 0;
        }
        .view-toggle button.active {
            background: var(--spy-gold);
            border-color: var(--spy-gold);
            color: var(--spy-black);
            font-weight: 600;
        }
        .view-toggle button:hover:not(.active) {
            border-color: var(--spy-gold);
            color: var(--spy-white);
        }
        .view-mode-support .tech-only {
            display: none !important;
        }
        .tech-hidden-note {
            display: none;
            text-align: center;
            padding: 12px 20px;
            margin-bottom: 30px;
            background: rgba(201, 162, 39, 0.08);
            border: 1px dashed var(--spy-gray-dark);
            border-radius: 8px;
            color: var(--spy-gray);
            font-size: 0.85em;
            font-style: italic;
        }
        .view-mode-support .tech-hidden-note {
            display: block;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const Arrow = () => <span className="arrow">‚Üí</span>;
        
        const FlowBox = ({ icon, title, desc, type }) => (
            <div className={`flow-box ${type}`}>
                <div className="flow-box-icon">{icon}</div>
                <div className="flow-box-title">{title}</div>
                <div className="flow-box-desc">{desc}</div>
            </div>
        );
        
        const DocCard = ({ title, desc, type, path }) => (
            <div className={`doc-card ${type}`}>
                <div className="doc-card-title">{title}</div>
                <div className="doc-card-desc">{desc}</div>
                {path && <div className="code-path">{path}</div>}
            </div>
        );
        
        
        const ViewToggle = ({ mode, setMode, t }) => (
            <div className="view-toggle">
                <button className={mode === 'support' ? 'active' : ''} onClick={() => { setMode('support'); try { localStorage.setItem('kb-view-mode', 'support'); } catch(e) {} }}>
                    {t("Support")}
                </button>
                <button className={mode === 'tech' ? 'active' : ''} onClick={() => { setMode('tech'); try { localStorage.setItem('kb-view-mode', 'tech'); } catch(e) {} }}>
                    {t("Technisch")}
                </button>
            </div>
        );
        
        const TechNote = ({ t }) => (
            <div className="tech-hidden-note">
                {t("Technische details verborgen ‚Äì schakel naar Technisch voor meer info")}
            </div>
        );

        const ShopifyWorkflow = ({ t = (k) => k, locale = 'da' }) => {
            return (
                <div className="container">
                    <h1>{t("Shopify Integration Workflow")}</h1>
                    <p className="subtitle">{t("Spy's webhook-baserede realtidssynkronisering med Shopify")}</p>
                    
                    <ViewToggle mode={viewMode} setMode={setViewMode} t={t} />
                    
                    <div className="legend">
                        <div className="legend-item">
                            <div className="legend-color shopify"></div>
                            <span>{t("Shopify")}</span>
                        </div>
                        <div className="legend-item">
                            <div className="legend-color spy"></div>
                            <span>{t("SPY System")}</span>
                        </div>
                        <div className="legend-item">
                            <div className="legend-color queue"></div>
                            <span>{t("Queue / Async")}</span>
                        </div>
                    </div>
                    
                    {/* Section 1: Overview */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üîó Arkitektur Overblik")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '20px', lineHeight: '1.6'}}>
                            {t("Spy's Shopify-integration er webhook-drevet og queue-baseret. Shopify sender events via webhooks til Spy's API. Hvert webhook valideres med HMAC-SHA256, og opretter en asynkron opgave i k√∏en. En worker processor h√•ndterer opgaverne i prioriteret r√¶kkef√∏lge.")}
                        </p>
                        <div className="flow-container">
                            <FlowBox icon="üõçÔ∏è" title={t("Shopify Store")} desc={t("Event opst√•r")} type="shopify" />
                            <Arrow />
                            <FlowBox icon="üîê" title={t("HMAC Validering")} desc={t("SHA256 signaturcheck")} type="spy" />
                            <Arrow />
                            <FlowBox icon="üìã" title={t("Queue Item")} desc={t("Task scheduleres")} type="queue" />
                            <Arrow />
                            <FlowBox icon="‚öôÔ∏è" title={t("Worker")} desc={t("Async processing")} type="spy" />
                            <Arrow />
                            <FlowBox icon="‚úÖ" title={t("SPY Opdateret")} desc={t("Data synkroniseret")} type="result" />
                        </div>
                        <div className="note-box">
                            <strong>{t("üí° Endpoint:")}</strong> <code>POST /api/v1/webhook/shopify</code> ‚Äî {t("alle webhooks modtages her. Shopify headers identificerer shop, topic og HMAC.")}
                        </div>
                    </div>
                    <TechNote t={t} />
                    
                    {/* Section 2: Webhook Flow */}
                    <div className="workflow-section tech-only">
                        <h2 className="section-title">{t("üîî Webhook Flow")}</h2>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("üì• Modtagelse")}</div>
                                <ul className="info-card-list">
                                    <li><code>X-Shopify-Shop-Domain</code> ‚Üí {t("Identificerer shop")}</li>
                                    <li><code>X-Shopify-Hmac-Sha256</code> ‚Üí {t("Signatur")}</li>
                                    <li><code>X-Shopify-Topic</code> ‚Üí {t("Event type")}</li>
                                    <li>{t("Body: JSON payload (oftest kun ID)")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üîê Validering (dobbelt)")}</div>
                                <ul className="info-card-list">
                                    <li>{t("1. Middleware: ShopifyWebhookValidator")}</li>
                                    <li>{t("2. Model: verifyWebhook() (belt-and-suspenders)")}</li>
                                    <li>{t("Finder ShopifyShop via dom√¶ne")}</li>
                                    <li>{t("S√¶tter system-bruger til 'Chuck Norris'")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üì§ Routing")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Topic ‚Üí handler-metode")}</li>
                                    <li>{t("Handler scheduler queue task")}</li>
                                    <li>{t("Returnerer 200 OK med det samme")}</li>
                                    <li>{t("Ingen inline processing")}</li>
                                </ul>
                            </div>
                        </div>
                        <div className="note-box">
                            <strong>{t("üí° Registrering:")}</strong> {t("Webhooks registreres automatisk via ShopifyShop::synchronizeWebhooks() baseret p√• access scopes og konfiguration. ReadOnly-mode forhindrer registrering.")}
                        </div>
                    </div>
                    
                    {/* Section 3: Order Import */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üõí Ordreimport (Shopify ‚Üí SPY)")}</h2>
                        <div className="flow-container">
                            <FlowBox icon="üõçÔ∏è" title={t("Ordre oprettet")} desc={t("orders/create")} type="shopify" />
                            <Arrow />
                            <FlowBox icon="üîê" title={t("HMAC Check")} desc={t("Valideret")} type="spy" />
                            <Arrow />
                            <FlowBox icon="ü™û" title={t("OrderMirrorTask")} desc={t("Henter fuld ordre via GraphQL")} type="queue" />
                            <Arrow />
                            <FlowBox icon="üì¶" title={t("OrderImportTask")} desc={t("Opretter SOrder i SPY")} type="spy" />
                            <Arrow />
                            <FlowBox icon="‚úÖ" title={t("Ordre klar")} desc={t("Klar til fulfillment")} type="result" />
                        </div>
                        <div className="info-grid" style={{marginTop: '20px'}}>
                            <div className="info-card">
                                <div className="info-card-title">{t("ü™û OrderMirrorTask")}</div>
                                <ul className="info-card-list">
                                    <li>{t("orders/create: k√∏rer med det samme")}</li>
                                    <li>{t("Andre topics: +15 sek. delay")}</li>
                                    <li>{t("Henter komplet ordre via GraphQL")}</li>
                                    <li>{t("Gemmer: linjer, shipping, tax, fulfillments, refunds, transaktioner")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üì¶ OrderImportTask")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Kun ved orders/create")}</li>
                                    <li>{t("Mapper kunde, validerer ordre")}</li>
                                    <li>{t("Integrerer med Webshipper for fragt")}</li>
                                    <li>{t("Fraud-analyse: 5 min. grace period")}</li>
                                    <li>{t("Kan s√¶tte ordre i karant√¶ne")}</li>
                                </ul>
                            </div>
                        </div>
                        <div className="note-box">
                            <strong>{t("‚ö†Ô∏è Krav for ordreimport:")}</strong> {t("allowExchange() + ReadCustomers scope + protected customer data access + bImportOrders = true")}
                        </div>
                    </div>
                    
                    {/* Section 4: Fulfillment & Returns */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üì¶ Fulfillment, Returneringer & Refunds")}</h2>
                        <div className="doc-types">
                            <DocCard 
                                title={t("Fulfillments (2 topics)")}
                                desc={t("fulfillments/create + update ‚Üí OrderMirrorTask + ReturnImportTask for relaterede returneringer")}
                                type="webhook"
                                path="FulfillmentsWebhookData"
                            />
                            <DocCard 
                                title={t("Returns (7 topics)")}
                                desc={t("approve, cancel, close, decline, reopen, request, update ‚Üí ReturnImportTask synkroniserer status")}
                                type="webhook"
                                path="ReturnsWebhookData"
                            />
                            <DocCard 
                                title={t("Refunds (1 topic)")}
                                desc={t("refunds/create ‚Üí RefundImportTask importerer refund og linker til original ordre")}
                                type="webhook"
                                path="RefundsCreateWebhookData"
                            />
                        </div>
                        <div className="note-box">
                            <strong>{t("üí° Krav:")}</strong> {t("allowRefundAndReturnImport() ‚Äî kr√¶ver ordreimport + RefundsAndReturns access layer")}
                        </div>
                    </div>
                    
                    {/* Section 5: Product Sync */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üëó Produktsynkronisering")}</h2>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("üì• Import (Shopify ‚Üí SPY)")}</div>
                                <ul className="info-card-list">
                                    <li>{t("products/create webhook")}</li>
                                    <li>{t("Kun for Create2Stay-produkter (iCreate2StayBrandID ‚â† 0)")}</li>
                                    <li>{t("Verificerer forfatter er Create2Stay-appen")}</li>
                                    <li>{t("Create2StaySynchronizeProductTask")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üì§ Export (SPY ‚Üí Shopify)")}</div>
                                <ul className="info-card-list">
                                    <li>{t("ProductDataExport ‚Äî produktdata")}</li>
                                    <li>{t("ProductMediaExport ‚Äî billeder/media")}</li>
                                    <li>{t("ProductPriceExport ‚Äî priser")}</li>
                                    <li>{t("ProductStockExport ‚Äî lagerbeholdning")}</li>
                                    <li>{t("ProductTranslationExport ‚Äî overs√¶ttelser")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üåç Markets & Locations")}</div>
                                <ul className="info-card-list">
                                    <li>{t("markets/create, update, delete ‚Üí fuld sync")}</li>
                                    <li>{t("locations/create, update, delete ‚Üí fuld sync")}</li>
                                    <li>{t("SynchronizeMarketsTask / SynchronizeLocationsTask")}</li>
                                    <li>{t("Kr√¶ver ReadMarkets / ReadLocations scope")}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    {/* Section 6: Queue System */}
                    <div className="workflow-section tech-only">
                        <h2 className="section-title">{t("‚öôÔ∏è Queue System")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '15px'}}>
                            {t("Alle webhooks ender som ShopifyShopQueueItem i databasen. ShopifyHandleQueueTask worker'en processerer dem asynkront.")}
                        </p>
                        <table className="priority-table">
                            <thead>
                                <tr>
                                    <th>{t("Prioritet")}</th>
                                    <th>{t("V√¶rdi")}</th>
                                    <th>{t("Typisk brug")}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>üî¥ {t("Highest")}</td>
                                    <td>85</td>
                                    <td>{t("Order mirror + import (webhook)")}</td>
                                </tr>
                                <tr>
                                    <td>üü† {t("High")}</td>
                                    <td>75</td>
                                    <td>‚Äî</td>
                                </tr>
                                <tr>
                                    <td>üü° {t("Medium")}</td>
                                    <td>50</td>
                                    <td>{t("Bulk operationer")}</td>
                                </tr>
                                <tr>
                                    <td>üîµ {t("Low")}</td>
                                    <td>25</td>
                                    <td>‚Äî</td>
                                </tr>
                                <tr>
                                    <td>‚ö™ {t("Lowest")}</td>
                                    <td>15</td>
                                    <td>{t("Baggrunds-sync")}</td>
                                </tr>
                            </tbody>
                        </table>
                        <div className="info-grid" style={{marginTop: '20px'}}>
                            <div className="info-card">
                                <div className="info-card-title">{t("üìä Status Flow")}</div>
                                <ul className="info-card-list">
                                    <li><code>pending</code> ‚Üí <code>running</code> ‚Üí <code>done</code></li>
                                    <li><code>pending</code> ‚Üí <code>running</code> ‚Üí <code>error</code></li>
                                    <li><code>pending</code> ‚Üí <code>skipped</code></li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üóëÔ∏è Oprydning (TTL)")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Fuldf√∏rte: 30 dage (standard)")}</li>
                                    <li>{t("Fejlede: 90 dage (til debugging)")}</li>
                                    <li>{t("OrderMirror: 7 dage (h√∏j volumen)")}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    {/* Section 7: Configuration */}
                    <div className="workflow-section tech-only">
                        <h2 className="section-title">{t("üîß Konfiguration")}</h2>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("üåê Globale indstillinger (SystemConfig_Shopify)")}</div>
                                <ul className="info-card-list">
                                    <li><code>bFullIntegrationEnabled</code> ‚Äî {t("Master switch for ordreimport")}</li>
                                    <li><code>bReadOnly</code> ‚Äî {t("Kun l√¶seadgang (ingen webhooks/exports)")}</li>
                                    <li><code>bDontReportFailedTransactions</code> ‚Äî {t("Undertrykker transaktionsfejl")}</li>
                                    <li><code>bSkipSalesTaxLinesWithZeroValue</code> ‚Äî {t("Ignorer nul-momslinjer")}</li>
                                    <li><code>bImportOrderNoteAttributesToSOrderComment</code></li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üè™ Per Shop (ShopifyShop entity)")}</div>
                                <ul className="info-card-list">
                                    <li><code>bImportOrders</code> ‚Äî {t("Import√©r ordrer fra denne shop")}</li>
                                    <li><code>iCreate2StayBrandID</code> ‚Äî {t("Create2Stay brand (0 = off)")}</li>
                                    <li>{t("Access Scopes: ReadLocations, ReadMarkets, ReadCustomers...")}</li>
                                    <li>{t("Access Layers: RefundsAndReturns")}</li>
                                    <li>{t("App Secret til HMAC verifikation")}</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üìç Admin UI")}</div>
                                <ul className="info-card-list">
                                    <li>{t("Admin ‚Üí Settings ‚Üí Integration ‚Üí Shopify")}</li>
                                    <li>{t("Shop: opret, rediger, oversigt")}</li>
                                    <li>{t("Order Mapping: feltkortl√¶gning")}</li>
                                    <li>{t("Freight: fragtkonfiguration + unmapped")}</li>
                                    <li>{t("Queue: overv√•g og administrer k√∏")}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    {/* Section 8: Troubleshooting */}
                    <div className="workflow-section">
                        <h2 className="section-title">{t("üîç Fejlh√•ndtering & Troubleshooting")}</h2>
                        <div className="doc-types">
                            <DocCard 
                                title={t("401 Unauthorized")}
                                desc={t("Ugyldigt shop-dom√¶ne, tomt app secret, eller HMAC mismatch. Tjek shop-konfigurationen.")}
                                type="error"
                            />
                            <DocCard 
                                title={t("422 Unprocessable")}
                                desc={t("Ugyldig webhook-data (ShopifyWebhookDataException). Tjek at payload matcher forventet format.")}
                                type="error"
                            />
                            <DocCard 
                                title={t("Webshipper: Ordre ikke fundet")}
                                desc={t("Retry hvert 5. min i 60 min ‚Üí bed Webshipper re-importere ‚Üí efter 120 min: karant√¶ne.")}
                                type="error"
                            />
                            <DocCard 
                                title={t("Webshipper: Fragtrate ikke fundet")}
                                desc={t("Retry hvert 5. min i 60 min ‚Üí derefter fejl. Tjek freight mapping i Admin.")}
                                type="error"
                            />
                            <DocCard 
                                title={t("Fraud analyse mangler")}
                                desc={t("Ordre < 5 min: venter p√• Shopify. Ordre > 5 min: importeres alligevel.")}
                                type="error"
                            />
                            <DocCard 
                                title={t("Database deadlock")}
                                desc={t("TransactionDeadlockException / LockWaitTimeout ‚Äî retryable, h√•ndteres automatisk.")}
                                type="error"
                            />
                            <DocCard 
                                title={t("Shopify API fejl")}
                                desc={t("Forbidden, Locked, PaymentRequired, Unauthorized, NotFound ‚Äî hver har specifik h√•ndtering.")}
                                type="error"
                            />
                            <DocCard 
                                title={t("Max 25 Webshipper retries")}
                                desc={t("Efter 25 API-fejl mod Webshipper ‚Üí permanent fejl. Tjek Webshipper-status.")}
                                type="error"
                            />
                        </div>
                    </div>
                    
                    {/* Section 9: All 37 Task Types */}
                    <div className="workflow-section tech-only">
                        <h2 className="section-title">{t("üìã Alle task-typer (37 total)")}</h2>
                        <div className="info-grid">
                            <div className="info-card">
                                <div className="info-card-title">{t("üõí Ordre (10 typer)")}</div>
                                <ul className="info-card-list">
                                    <li>OrderMirror, OrderMirrorCheck</li>
                                    <li>OrderImport, OrderImportManager</li>
                                    <li>OrderExport, OrderCheck</li>
                                    <li>OrderCheckTransactionStatus</li>
                                    <li>OrderSynchronization</li>
                                    <li>OrderFinancialStatusCheck(Manager)</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üëó Produkt (12 typer)")}</div>
                                <ul className="info-card-list">
                                    <li>ProductDataExport(Manager)</li>
                                    <li>ProductMediaExport(Manager)</li>
                                    <li>ProductDataAndMediaExport(Manager)</li>
                                    <li>ProductDelete, ProductDeleteVariant</li>
                                    <li>ProductPriceExport, ProductStockExport</li>
                                    <li>ProductTranslationExport</li>
                                    <li>ProductBulkUpdatePrices</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üîÑ Refund, Return & Sync (9 typer)")}</div>
                                <ul className="info-card-list">
                                    <li>RefundImport, RefundImportManager</li>
                                    <li>ReturnImport</li>
                                    <li>SynchronizeLocales, Locations, Markets</li>
                                    <li>SynchronizeMarketPrices</li>
                                    <li>SynchronizeMarketPriceListPrices</li>
                                    <li>SynchronizeProductIDs</li>
                                </ul>
                            </div>
                            <div className="info-card">
                                <div className="info-card-title">{t("üé® Create2Stay & Andet (6 typer)")}</div>
                                <ul className="info-card-list">
                                    <li>Create2StaySynchronizeProduct</li>
                                    <li>Create2StayHandleFulfillment</li>
                                    <li>Create2StayHandleReturn</li>
                                    <li>SeasonCampaignPriceUpdate</li>
                                    <li>PausePriceUpdatesPriceUpdate</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    {/* Code Structure */}
                    <div className="workflow-section tech-only">
                        <h2 className="section-title">{t("üóÇÔ∏è Kodestruktur")}</h2>
                        <div className="code-structure">
                            <span className="folder">class/EDI/Shopify/</span><br/>
                            &nbsp;&nbsp;‚îú‚îÄ‚îÄ Entity/ShopifyShop.php <span className="comment">‚Üê {t("Shop-forbindelse")}</span><br/>
                            &nbsp;&nbsp;‚îú‚îÄ‚îÄ Entity/ShopifyShopQueueItem.php <span className="comment">‚Üê {t("Queue-poster")}</span><br/>
                            &nbsp;&nbsp;‚îú‚îÄ‚îÄ API/ShopifyAPI.php <span className="comment">‚Üê {t("REST API klient")}</span><br/>
                            &nbsp;&nbsp;‚îú‚îÄ‚îÄ GraphQL/ShopifyGraphQLClient.php <span className="comment">‚Üê {t("GraphQL klient")}</span><br/>
                            &nbsp;&nbsp;‚îú‚îÄ‚îÄ Task/ <span className="comment">‚Üê {t("Alle 37 task-klasser")}</span><br/>
                            &nbsp;&nbsp;‚îÇ&nbsp;&nbsp;&nbsp;‚îú‚îÄ‚îÄ OrderMirrorTask.php<br/>
                            &nbsp;&nbsp;‚îÇ&nbsp;&nbsp;&nbsp;‚îú‚îÄ‚îÄ OrderImportTask.php<br/>
                            &nbsp;&nbsp;‚îÇ&nbsp;&nbsp;&nbsp;‚îî‚îÄ‚îÄ ...<br/><br/>
                            <span className="folder">applications/API/V1/</span><br/>
                            &nbsp;&nbsp;‚îú‚îÄ‚îÄ Controller/Webhook/Shopify/Controller.php <span className="comment">‚Üê {t("Webhook endpoint")}</span><br/>
                            &nbsp;&nbsp;‚îú‚îÄ‚îÄ Model/Webhook/Shopify/Model.php <span className="comment">‚Üê {t("Routing + HMAC")}</span><br/>
                            &nbsp;&nbsp;‚îú‚îÄ‚îÄ Middleware/ShopifyWebhookValidator.php <span className="comment">‚Üê {t("HMAC middleware")}</span><br/>
                            &nbsp;&nbsp;‚îî‚îÄ‚îÄ Model/Webhook/Shopify/Data/ <span className="comment">‚Üê {t("Webhook data-klasser")}</span><br/><br/>
                            <span className="folder">class/SystemConfig/SystemConfig_Shopify.php</span> <span className="comment">‚Üê {t("Global konfiguration")}</span>
                        </div>
                    </div>
                    
                    {/* CLI Tools */}
                    <div className="workflow-section tech-only">
                        <h2 className="section-title">{t("üõ†Ô∏è CLI V√¶rkt√∏jer")}</h2>
                        <p style={{color: '#b3b3b3', marginBottom: '15px'}}>
                            {t("Placeret i tools/Shopify/ ‚Äî bruges til debugging, bulk-operationer og sync.")}
                        </p>
                        <div className="doc-types">
                            <DocCard title={t("ImportOrder.php")} desc={t("Import√©r en enkelt ordre efter Shopify order-ID")} type="task" path="tools/Shopify/" />
                            <DocCard title={t("OrderMirror.php")} desc={t("Mirror en ordre manuelt")} type="task" path="tools/Shopify/" />
                            <DocCard title={t("QuarantineOrder.php")} desc={t("S√¶t en ordre i karant√¶ne")} type="task" path="tools/Shopify/" />
                            <DocCard title={t("ProductStockCompare.php")} desc={t("Sammenlign lager mellem Spy og Shopify")} type="task" path="tools/Shopify/" />
                            <DocCard title={t("SendAllStyles.php")} desc={t("Eksport√©r alle styles til Shopify")} type="task" path="tools/Shopify/" />
                            <DocCard title={t("SynchronizeMarkets.php")} desc={t("Synkroniser markets manuelt")} type="task" path="tools/Shopify/" />
                        </div>
                    </div>
                    
                    <p className="footer-text">
                        {t("Genereret af")} <span>Nova</span> | SPY ApS | {new Date().toLocaleDateString(locale === 'en' ? 'en-GB' : 'da-DK')} | {t("Baseret p√• Spy codebase-analyse")}
                    </p>
                </div>
            );
        };
        
        // Initialize i18n and render
        (async function() {
            const { locale, t } = await window.i18n.initI18n('shopify-flow-workflow');
            ReactDOM.render(<ShopifyWorkflow t={t} locale={locale} />, document.getElementById('root'));
            window.i18n.autoApplyTranslations(200);
        })();
    </script>
</body>
</html>
